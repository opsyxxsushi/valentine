<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Be My Valentine?</title>
    <link rel="stylesheet" href="index.css">
    <link rel="icon" type="image/png" href="heart_00000.png">

</head>
<body onmousemove="startMusic()" onclick="startMusic()" ontouchstart="startMusic()">
<div id="lock-screen" style="position:fixed; top:0; left:0; width:100%; height:100%; background:black; color:white; z-index:9999; display:none; flex-direction:column; align-items:center; justify-content:center; font-family: 'Helvetica', Arial, sans-serif;">
    
    <p style="letter-spacing: -.4px; font-size: 100px; font-weight: 400;">TEMPORARY LOCKED</p>
    
    <p style="cursor:pointer; color:#fff; font-size: 1rem; margin-top: 20px; transition: 0.3s;" 
       onmouseover="this.style.color='#fff'" 
       onmouseout="this.style.color='#333'" 
       onclick="showInput()">Admin Override?</p>
    
    <div id="input-container" style="position:fixed; bottom:-100px; transition:0.5s ease-in-out; background:#111; padding:30px; width:100%; display:flex; justify-content:center; gap:15px; border-top: 1px solid #222;">
        <input type="text" id="keyInput" placeholder="ENTER ACCESS KEY" style="background:transparent; border: 1px solid #444; color:white; padding:10px; outline:none; font-family:sans-serif; width: 200px;">
        <button onclick="checkKey()" style="background:white; color:black; border:none; padding:10px 25px; cursor:pointer; font-weight:bold; font-size: 0.8rem;">UNLOCK</button>
    </div>
</div>

<script>
    const validKeys = ["A9F7K2QX", "M4Z8T6LP", "QX3N7A9E", "7KPF2M8R", "L9A6XQ4T", "R2M7ZK8A", "XQ5T9F3N", "8A6RZPQM", "T4KX7N9A", "ZP2F8Q6M"];
    const lockScreen = document.getElementById('lock-screen');
    const mainContent = document.getElementById('main-content');

    // 1. CHECK IF ALREADY UNLOCKED ON LOAD
    window.onload = function() {
        if (sessionStorage.getItem('siteUnlocked') === 'true') {
            lockScreen.style.display = 'none';
            mainContent.style.display = 'block';
        } else {
            lockScreen.style.display = 'flex';
        }
    };

    function showInput() {
        document.getElementById('input-container').style.bottom = "0";
    }

    function checkKey() {
        const input = document.getElementById('keyInput').value.trim().toUpperCase();
        
        if (validKeys.includes(input)) {
            // Check if this specific key was used globally (simulated via localStorage)
            if (localStorage.getItem('void_' + input)) {
                alert("ACCESS DENIED: KEY PREVIOUSLY VOIDED");
            } else {
                // VOID THE KEY and UNLOCK SITE
                localStorage.setItem('void_' + input, 'true');
                sessionStorage.setItem('siteUnlocked', 'true'); // Keeps them logged in for this session
                
                lockScreen.style.display = 'none';
                mainContent.style.display = 'block';
            }
        } else {
            alert("INVALID ACCESS KEY");
        }
    }
</script>

<div id="main-content" style="display:none;">
    
    </div>
    <audio id="bgMusic" loop>
        <source src=".mp3" type="audio/mpeg">
    </audio>

    <form id="no-form" action="https://formspree.io/f/mjgwqgen" method="POST" style="display:none;">
        <input type="text" name="message" value="The user confirmed NO and was redirected to YouTube.">
    </form>

    <div class="container">
        <div id="gif-container" class="gif-wrapper">
            <img id="main-gif" src="minions-heart.gif" alt="Minions Heart" style="width: 100%; border-radius: 10px;">
        </div>

        <h1 id="title">Will you be my Valentine?</h1>

        <div class="btn-group">
            <button id="yesBtn">Yes</button>
            <button id="noBtn">No</button>
        </div>
    </div>

    <script>
        const yesBtn = document.getElementById('yesBtn');
        const noBtn = document.getElementById('noBtn');
        const titleText = document.getElementById('title');
        const mainGif = document.getElementById('main-gif');
        const noForm = document.getElementById('no-form');
        const bgMusic = document.getElementById('bgMusic');
        
        let hoverCount = 0;
        let isSecondPhase = false;
        let musicStarted = false;

        // This function plays the music once and then "self-destructs" so it doesn't restart
        function startMusic() {
            if (!musicStarted) {
                bgMusic.play().then(() => {
                    musicStarted = true;
                }).catch(err => {
                    // Still blocked by browser, will try again on next move/click
                });
            }
        }

        function setYesToNormal() {
            yesBtn.onclick = () => { window.location.href = 'confirm.html'; };
        }
        setYesToNormal();

        noBtn.addEventListener('mouseover', () => {
            if (hoverCount < 10 && !isSecondPhase) {
                const x = Math.random() * (window.innerWidth - noBtn.offsetWidth);
                const y = Math.random() * (window.innerHeight - noBtn.offsetHeight);
                noBtn.style.position = 'absolute';
                noBtn.style.left = x + 'px';
                noBtn.style.top = y + 'px';
                hoverCount++;
            } else if (hoverCount >= 10 && !isSecondPhase) {
                noBtn.style.position = 'static';
                titleText.innerText = "Well, here's your no button";
                mainGif.src = "sad-minion.gif";
            }
        });

        noBtn.addEventListener('click', async () => {
            if (hoverCount >= 10) {
                if (!isSecondPhase) {
                    isSecondPhase = true;
                    titleText.innerText = "Are you sure?";
                    
                    yesBtn.onclick = async () => {
                        const formData = new FormData(noForm);
                        try {
                            await fetch(noForm.action, {
                                method: 'POST',
                                body: formData,
                                headers: { 'Accept': 'application/json' }
                            });
                        } catch (e) { console.log("Formspree failed"); }
                        window.location.href = "https://youtu.be/EFEh0npHExw?list=RDEFEh0npHExw";
                    };
                } else {
                    isSecondPhase = false;
                    hoverCount = 0;
                    titleText.innerText = "Will you be my Valentine?";
                    mainGif.src = "minions-heart.gif";
                    setYesToNormal();
                    noBtn.style.position = 'static';
                }
            }
        });
    </script>
</body>
</html>
